{% extends "catalogue/base.html" %}
{% load verbose_name %}
{% load list_fields %}
{% load bulma_tags %}
{% block title %}Komponente - {{ component.name }}{% endblock %}
{% block body %}
  <section class="section has-background-primary has-text-white">
    <div class="container is-max-widescreen">
      <div class="media">
        <div class="media-content">
          <h1 class="title is-3 has-text-white">
            {{ component.name }}
          </h1>
          <h2 class="subtitle is-5 has-text-white">
            {{ component.manufacturer }}
          </h2>
        </div>
        <div class="media-right">
          {% include "catalogue/includes/trl.html" with component=component only %}
        </div>
      </div>
      <div class="content mt-4">
        <p>{{ component.description }}</p>
      </div>
      <a class="button is-rounded is-small is-pulled-right is-primary-light has-text-primary has-text-weight-bold"
         href="#contact">
        Anbieter kontaktieren
      </a>
      {% for t in component.task_set.all %}
        <a class="tag has-background-info is-rounded has-text-primary-dark has-text-weight-bold"
           href="{% url 'catalogue:search' %}?task__name={{ t.name }}">{{ t.get_name_display }}</a>
      {% endfor %}
    </div>
  </section>
  <section class="section has-background-primary has-text-white p-0">
    <div class="container is-max-widescreen">
      <div class="tabs">
        <ul>
          <li class="tabLink is-active has-background-primary-light has-text-weight-bold is-uppercase"
              onclick="openTab(event, 'tab1')">
            <a>Grunddaten</a>
          </li>
          <li class="tabLink has-background-grey-light has-text-weight-bold is-uppercase"
              onclick="openTab(event, 'tab2')">
            <a>Voraussetzungen</a>
          </li>
        </ul>
      </div>
    </div>
  </section>
  <section id="tab1" class="section tab">
    <div class="container is-max-widescreen">
      {% check_category_empty component applicationprofile_fields as is_empty %}
      {% if not is_empty %}
        <h3 class="title is-4">{{ applicationprofile_name }}</h3>
        {% for field in applicationprofile_fields %}
          {% get_verbose_field_name component field as title %}
          {% get_field component field as val %}
          {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}
        {% endfor %}

        {% get_related_field_value component "corporatedivision" as val %}
        {% verbose_name component.corporatedivision_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}

        {% get_related_field_value component "hierarchylevel" as val %}
        {% verbose_name component.hierarchylevel_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}

        {% get_related_field_value component "process" as val %}
        {% verbose_name component.process_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}

        {% get_related_field_value component "branchproven" as val %}
        {% verbose_name component.branchproven_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}

        {% get_related_field_value component "branchapplicable" as val %}
        {% verbose_name component.branchapplicable_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}

        <hr>
      {% endif %}
      {% check_category_empty component use_fields as is_empty %}
      {% if not is_empty or component.kpi %}
        <h3 class="title is-4">{{ use_name }}</h3>
        {% for field in use_fields %}
          {% get_verbose_field_name component field as title %}
          {% get_field component field as val %}
          {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}
        {% endfor %}

        {% get_related_field_value component "kpi" as val %}
        {% verbose_name component.kpi_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}
        <hr>
      {% endif %}
    </div>
  </section>
  <section id="tab2" class="section tab" style="display: none">
    <div class="container is-max-widescreen">
      {% check_category_empty component requirements_fields as is_empty %}
      {% if not is_empty %}
        <h3 class="title is-4">{{ requirements_name }}</h3>
        {% for field in requirements_fields %}
          {% get_verbose_field_name component field as title %}
          {% get_field component field as val %}
          {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}
        {% endfor %}
        <hr>
      {% endif %}
      {% check_category_empty component technicalspecification_fields as is_empty %}
      {% if not is_empty or component.licenses_set or component.aimethod_set or component.dataanalysisprocess_set %}
        <h3 class="title is-4">{{ technicalspecification_name }}</h3>
        {% for field in technicalspecification_fields %}
          {% get_verbose_field_name component field as title %}
          {% get_field component field as val %}
          {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}
        {% endfor %}

        {% get_related_field_value component "aimethod" as val %}
        {% verbose_name component.aimethod_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}

        {% get_related_field_value component "dataanalysisprocess" as val %}
        {% verbose_name component.dataanalysisprocess_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}

        {% get_related_field_value component "licenses" as val %}
        {% verbose_name component.licenses_set as title %}
        {% include "catalogue/includes/component-detail-columns.html" with title=title value=val only %}
        <hr>
      {% endif %}
    </div>
  </section>
  <section id="contact" class="section bg-bubble-gradient">
    <div class="container is-max-widescreen">
      <div class="columns">
        <div class="column is-half">
          <h3 class="title is-3 has-text-white">
            LÃ¶sungsanbieter:
          </h3>
          <h4 class="subtitle is-5 has-text-white">{{ component.manufacturer }}</h4>
          <p class="has-text-white">Kontakt: {{ component.contact }}</p>
          <p class="has-text-white">{{ component.additional_info }}</p>
        </div>
        <div class="column is-half">
          <div class="card">
            <div class="card-content">
              <p class="title is-3">Kontaktanfrage</p>
              <form method="post">
                {% csrf_token %}
                {{ form|bulma }}
                <div class="field">
                  <div class="control">
                    <button class="button is-link is-rounded">Senden</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}
{% block script %}
  <script>
    function openTab(event, tabName) {
      var i, x;
      var activeClasses = document.getElementsByClassName("tabLink is-active")[0].className;
      var inactiveClasses = document.querySelectorAll("li.tabLink:not(.is-active)")[0].className;
      var tablinks = document.getElementsByClassName("tabLink");
      // tab selection
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = inactiveClasses;
      }
      event.currentTarget.className = activeClasses;
      // switch content
      x = document.getElementsByClassName("tab");
      for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";
      }
      document.getElementById(tabName).style.display = "block";
    }
  </script>
{% endblock %}